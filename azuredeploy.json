{
    "$schema": "https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
    "contentVersion": "1.0.0.0",
    "parameters": {
        "vmName": { "type": "string" },
        "vmSSName": { "type": "string" },
        "instanceCount": { "type": "string" },
        "adminUsername": { "type": "string" },
        "adminPassword": { "type": "securestring" },
        "resourcePrefix": { "type": "string" }  
    },
    "variables": {
        "deploymentApiVersion": "2015-01-01",
        "location": "[resourceGroup().location]",
        "baseUrl": "https://raw.githubusercontent.com/chef-customers/chef-automate-azure/OrchestrationTemplate/",
        "scalesetURL": "[concat(variables('baseUrl'),'nestedTemplates/scaleset.json')]",
        "vmmssURL": "[concat(variables('baseUrl'),'nestedTemplates/vmmss.json')]",
        "scriptUrl": "[concat(variables('baseUrl'),'nestedTemplates/vm-disk-utils-centos-0.1.sh')]"
    },
    "resources": [
       // {
       //     "name": "scalesetResource",
      //      "type": "Microsoft.Resources/deployments",
      //      "apiVersion": "[variables('deploymentApiVersion')]",
      //      "properties": {
      //          "mode": "Incremental",
      //          "templateLink": {
      //              "uri": "[variables('scalesetURL')]",
      //              "contentVersion": "1.0.0.0"
      //          },
      //      "parameters": { 
      //          "vmName":  {"value" : "uniquestring([parameters('vmName'))]"},
      //          "vmSSName": {"value" : "uniquestring([parameters('vmSSName')]"},
      //          "instanceCount": {"value" : "[parameters('instanceCount')]"},
      //          "adminUsername": {"value" : "[parameters('adminUsername')]"},
      //          "adminPassword": {"value" : "[parameters('adminPassword')]"},
      //          "resourcePrefix":{"value" : "[parameters('resourcePrefix')]"} 
      //          }
      //      }    
      //  },
      //  {
      //      "name": "StandAloneResource",
      //      "type": "Microsoft.Resources/deployments",
      //      "apiVersion": "[variables('deploymentApiVersion')]",
      //      "properties": {
      //          "mode": "Incremental",
      //          "templateLink": {
      //              "uri": "[variables('vmmssURL')]",
      //              "contentVersion": "1.0.0.0"
      //          },
      //      "parameters": { 
      //          "vmName":  {"value" : "[concat(uniquestring(parameters('vmName')), 'ChefStandAlone')]"},
      //          "adminUsername": {"value" : "[parameters('adminUsername')]"},
      //          "adminPassword": {"value" : "[parameters('adminPassword')]"}
      //          }
      //      }    
      //  },
      //  {
      //      "name": "ChefAutomateResource",
      //      "type": "Microsoft.Resources/deployments",
     //       "apiVersion": "[variables('deploymentApiVersion')]",
      //      "properties": {
      //          "mode": "Incremental",
      //          "templateLink": {
      //              "uri": "[variables('vmmssURL')]",
      //              "contentVersion": "1.0.0.0"
     //          },
     //       "parameters": { 
     //           "vmName":  {"value" : "[concat(uniquestring(parameters('vmName')), 'ChefAutomate')]"},
     //           "adminUsername": {"value" : "[parameters('adminUsername')]"},
     //           "adminPassword": {"value" : "[parameters('adminPassword')]"}
     //           }
     //      }    
     //   }, 
        {
            "type": "Microsoft.Compute/virtualMachines/extensions",
            "name": "CustomScriptForLinux",
            "apiVersion": "[variables('deploymentApiVersion')]",
            "location": "[variables('location')]",
            "properties": {
                "publisher": "Microsoft.OSTCExtensions",
                "type": "CustomScriptForLinux",
                "typeHandlerVersion": "1.4",
                "settings": {
                    "fileUris": [
                        "[variables('scriptUrl')]"
                    ],
                    "commandToExecute": "./create_containers.sh"
                }
            }
        }
    ],
    "outputs": {
        
    }
}
